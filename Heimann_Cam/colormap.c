#include <string.h>

#include "heimann_drv.h"
//保存了热力图的颜色表，格式为rgb565
static uint16_t colormap[180];

uint16_t classic[180] = {
0x0002, 0x0003, 0x0003, 0x0004, 0x0004, 0x0005, 0x0005, 0x0006, 0x0006, 0x0007, 
0x0007, 0x0008, 0x0008, 0x0009, 0x0009, 0x000a, 0x000a, 0x000b, 0x000b, 0x000c, 
0x000c, 0x000d, 0x000d, 0x000e, 0x000e, 0x000f, 0x000f, 0x0010, 0x0010, 0x0011, 
0x0011, 0x0011, 0x0811, 0x0810, 0x1010, 0x1010, 0x1810, 0x180f, 0x200f, 0x200f, 
0x280f, 0x280e, 0x300e, 0x300e, 0x380e, 0x380d, 0x400d, 0x400d, 0x480d, 0x480c, 
0x500c, 0x500c, 0x580c, 0x580b, 0x600b, 0x600b, 0x680b, 0x680a, 0x700a, 0x700a, 
0x780a, 0x7809, 0x8009, 0x8009, 0x8809, 0x8808, 0x9008, 0x9008, 0x9808, 0x9807, 
0xa007, 0xa007, 0xa807, 0xa806, 0xb006, 0xb006, 0xb806, 0xb805, 0xc005, 0xc005, 
0xc805, 0xc804, 0xd004, 0xd004, 0xd804, 0xd803, 0xe003, 0xe003, 0xe803, 0xe802, 
0xf801, 0xf801, 0xf821, 0xf821, 0xf841, 0xf841, 0xf861, 0xf861, 0xf881, 0xf880, 
0xf8a0, 0xf8a0, 0xf8c0, 0xf8c0, 0xf8e0, 0xf8e0, 0xf900, 0xf900, 0xf920, 0xf920, 
0xf940, 0xf940, 0xf960, 0xf960, 0xf980, 0xf980, 0xf9a0, 0xf9a0, 0xf9c0, 0xf9c0, 
0xf9e0, 0xfa00, 0xfa20, 0xfa60, 0xfa80, 0xfac0, 0xfae0, 0xfb20, 0xfb40, 0xfb80, 
0xfba0, 0xfbe0, 0xfc00, 0xfc20, 0xfc60, 0xfc80, 0xfcc0, 0xfce0, 0xfd20, 0xfd40, 
0xfd80, 0xfda0, 0xfde0, 0xfe00, 0xfe40, 0xfe60, 0xfe80, 0xfec0, 0xfee0, 0xff20, 
0xff40, 0xff41, 0xff62, 0xff63, 0xff64, 0xff65, 0xff66, 0xff67, 0xff88, 0xff89, 
0xff8a, 0xff8b, 0xff8c, 0xff8d, 0xffae, 0xffaf, 0xffb1, 0xffb2, 0xffb3, 0xffb4, 
0xffd5, 0xffd6, 0xffd7, 0xffd8, 0xffd9, 0xffda, 0xfffb, 0xfffc, 0xfffd, 0xfffe
};

void get_rgb888_from_rgb565(uint16_t val, uint8_t* r8, uint8_t* g8, uint8_t* b8) 
{
    // if (index < 0) index = 0;
    // if (index > 179) index = 179;

    uint16_t rgb565 = val;

    uint8_t r5 = (rgb565 >> 11) & 0x1F;
    uint8_t g6 = (rgb565 >> 5) & 0x3F;
    uint8_t b5 = rgb565 & 0x1F;

    *r8 = (r5 << 3) | (r5 >> 2);
    *g8 = (g6 << 2) | (g6 >> 4);
    *b8 = (b5 << 3) | (b5 >> 2);

    // // 返回 0x00RRGGBB 格式的颜色
    // return (r8 << 16) | (g8 << 8) | b8;
}

void load_colormap(uint8_t index) {
    if(index == COLORMAP_CLASSIC)
    memcpy(colormap, classic, sizeof(colormap));

    // cmap_loading_lock = true;
    // if (index == COLORMAP_CLASSIC) {
    //     memcpy_P(colormap, classic, sizeof(colormap));
    // }else if (index == COLORMAP_VIRIDIS) {
    //     memcpy_P(colormap, viridis, sizeof(colormap));
    // }else if(index == COLORMAP_HOT) {
    //     memcpy_P(colormap, hot, sizeof(colormap));
    // }else if(index == COLORMAP_TURBO) {
    //     memcpy_P(colormap, turbo, sizeof(colormap));
    // }else if(index == COLORMAP_INFERNO) {
    //     memcpy_P(colormap, inferno, sizeof(colormap));
    // }else if(index == COLORMAP_GRAYSR) {
    //     memcpy_P(colormap, greys_r, sizeof(colormap));
    // }else if(index == COLORMAP_GRAYS) {
    //     memcpy_P(colormap, greys, sizeof(colormap));
    // }else{
    //     memcpy_P(colormap, classic, sizeof(colormap));
    // }
    // cmap_loading_lock = false;
}